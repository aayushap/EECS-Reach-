#include <gamma.h>
#include <RGBmatrixPanel.h>
#include <Adafruit_GFX.h>

// define the wiring of the LED screen
const uint8_t CLK = 8;
const uint8_t LAT = A3;
const uint8_t OE = 9;
const uint8_t A = A0;
const uint8_t B = A1;
const uint8_t C = A2;

// define the wiring of the inputs
const int POTENTIOMETER_PIN_NUMBER = 5;
const int BUTTON_PIN_NUMBER = 10;

// a global variable that represents the LED screen
RGBmatrixPanel matrix(A, B, C, CLK, LAT, OE, false);

// the following functions are for printing messages
void print_score(int score);
void game_over();

class Color {
public:
  int red;
  int green;
  int blue;
  Color() {
    red = 0;
    green = 0;
    blue = 0;
  }
  Color(int r, int g, int b) {
    red = r;
    green = g;
    blue = b;
  }
  uint16_t to_333() const {
    return matrix.Color333(red, green, blue);
  }
};

const Color BLACK(0, 0, 0);
const Color RED(7, 0, 0);
const Color ORANGE(7, 4, 0);
const Color YELLOW(7, 7, 0);
const Color GREEN(0, 7, 0);
const Color BLUE(0, 0, 7);
const Color PURPLE(7, 0, 7);
const Color WHITE(7, 7, 7);
const Color LIME(4, 7, 0);
const Color AQUA(0, 7, 7);

class Bird {
  public:
  //Default and Non-Default Constructor
  Bird(){
     x = 0; 
     y = 0; 
     life = 1; 
  }

  Bird(int x_arg, int y_arg){
    initialize(x_arg, y_arg); 
  }
  
  void initialize (int x_arg, int y_arg){
    x = x_arg; 
    y = y_arg; 
    life = 1; 
  }
  
  //Getters & Setters for Bird
  int get_x() const {
    return x;
  }
  int get_y() const {
    return y; 
  }
  int get_life() const {
    return life; 
  }
  int set_y(int y_arg) {
    y = y_arg;
  }
  
  //Moves the bird to the right
  //Modifies: x, y
  void move() {
  int outofBounds = 16;
  bool button_pressed;
      if (button_pressed) {
        y = y + 2;
      }
      else {
        y = y - 1;
      //He must fall (change height/y) as he travels along (distance/x). What rate? 
      }
  }
  //Draws the Flappy Bird if life greater than 0
  //Calls: draw_with_rgb
  void draw() {
    if (life < 1) {
     erase(); 
    }
    else {
     draw_with_rgb(YELLOW, WHITE, BLUE); 
    }
  }
  
  //Bird flies into the Pipe or hits the ground! 
  //Calls: erase
  void hit() {
    erase(); 
   }

  //Draws the background color, Aqua, where the Flappy Bird used to be.
  //Calls: draw_with_rgb
  void erase() {
    draw_with_rgb(BLACK, BLACK, BLACK); 
  }
  
  private:
  int x; 
  int y; 
  int life; 
  
  //Draws Flappy Bird
  void draw_with_rgb(Color body_color, Color eye_color, Color mouth_color){
    matrix.drawPixel(x + 4, y + 7, body_color.to_333()); 
    matrix.drawPixel(x + 4, y + 6, body_color.to_333()); 
    matrix.drawPixel(x + 5, y + 7, eye_color.to_333()); 
    matrix.drawPixel(x + 5, y + 6, mouth_color.to_333()); 
  }
};

class Pipes {
  public: 
  //Default and Non-default Constructors
  Pipes() {
    x = 0;
    y = 0;
  }
  
  //Initializes the width and height of Pipes
  Pipes(int width, int height) {
    initialize(width, height);
  }
  
  void initialize(int width, int height) {
    x = width;
    y = height;
  }
  
  //Getters and Setters for x and y
  int get_x() const {
    return x;
  }
  
  int get_y() const {
    return y;
  }
  
  //Y remains the same, while the X moves to the left
  void move() {
  }
  
  //Draws the Pipe
  void draw() {
  }

  private: 
  int x; //width
  int y; //Height

  //Draws the Pipe (with RGB Green) randomized Y values
  void draw_with_rgb(Color side_pipe_color, Color top_pipe_color){
 
  }
};

class Game {
  public:
  //Constructor for Game class
  Game(){ 
    time = 0; 
    score = 0; 
  }
  
  //Sets up a new Game of FlappyBird
  //Modifies: Global variable Matrix
  void setup(){
    reset_game(); 
   }
   
  // advances the game simulation one step and renders the graphics
  // see spec for details of game
  // Modifies: global variable matrix
  void update(int potentiometer_value, bool button_pressed){ 
    delay(10);
    time = millis() / 1000;
    bird.erase();
    bird.set_y(potentiometer_value / 32);
    bird.draw();
  }
   

    //if statements if the bird hits the pipe or the ground

  private:
  int score; 
  int time; 
  Bird bird; 
    //Array of Pipes for Flappy Bird
  Pipes pipe; 
  
  //Resets the Game
  void reset_game(){
    //CODE
  }
};

Game game; 

void setup() {
 Serial.begin(9600);
  pinMode(BUTTON_PIN_NUMBER, INPUT);
  matrix.begin();
  game.setup();
}

void loop() {
   int potentiometer_value = analogRead(POTENTIOMETER_PIN_NUMBER);
  bool button_pressed = (digitalRead(BUTTON_PIN_NUMBER) == HIGH);
  game.update(potentiometer_value, button_pressed);
}

void print_score(int score) {
  matrix.setCursor(9,0); //Fix ME to place the score in the right place
  matrix.setTextSize(0.5); //Possibly fix as well
  
  matrix.setTextColor(matrix.Color333(7,0,0));
  matrix.print('S');
  matrix.setTextColor(matrix.Color333(7,0,0));
  matrix.print('C');
  matrix.setTextColor(matrix.Color333(7,0,0));
  matrix.print('O');
  matrix.setTextColor(matrix.Color333(7,0,0));
  matrix.print('R');
  matrix.setTextColor(matrix.Color333(7,0,0));
  matrix.print('E');
  matrix.setTextColor(matrix.Color333(7,0,0));
  matrix.print(':');
  
  matrix.setCursor(13, 9);   // CHANGE CURSOR TO BE SMALLER and under the "Score"
  matrix.setTextColor(matrix.Color333(0,7,0)); 
  matrix.print(score);
}

//Displays "Game Over"
void game_over() {
matrix.setCursor(3,0);
matrix.setTextSize(1);

//game over displays in red
matrix.setTextColor(matrix.Color333(7,0,0));
matrix.print('G');
matrix.setTextColor(matrix.Color333(7,0,0));
matrix.print('A');
matrix.setTextColor(matrix.Color333(7,0,0));
matrix.print('M');
matrix.setTextColor(matrix.Color333(7,0,0));
matrix.print('E');

matrix.setCursor(2,9);
matrix.setTextColor(matrix.Color333(7,0,0));
matrix.print('O');
matrix.setTextColor(matrix.Color333(7,0,0));
matrix.print('V');
matrix.setTextColor(matrix.Color333(7,0,0));
matrix.print('E');
matrix.setTextColor(matrix.Color333(7,0,0));
matrix.print('R');
matrix.setTextColor(matrix.Color333(7,0,0));
matrix.print('!');
}
